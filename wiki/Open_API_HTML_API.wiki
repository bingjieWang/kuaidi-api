#labels Openapi,API,快递接口,快递API,快递查询接口,快递查询API
= HtmlAPI =
（公测版）
   === 1、支持EMS、顺丰和申通 ===
   === 2、稳定性强、速度快 ===
   === 3、易开发、安全性高 ===
   === 如果有疑问，可以添加企业QQ 4008800898 转 快递100 咨询 ===

= 一、API请求地址：=
   http://www.kuaidi100.com/applyurl?key=[]&com=[]&nu=[]

= 二、传入参数说明：=
|| *参数* || *是否必需* || *说明* ||
|| key || 是 || 快递100的授权key，*如果已有快递100的key，可以直接使用已有的*；如果还没有申请，请到 [http://www.kuaidi100.com/openapi/api_2_02.shtml?typeid=1 快递查询API]提交申请。||
|| com || 是 || 快递公司编码见下表||
|| nu || 是 || 快递单号  ||


||*分类*|| *快递公司代码* || *公司名称* ||
||*E*|| || ||
|| ||ems||EMS||
||*S*|| || ||
|| ||shentong||伸通||
|| ||shentong||伸通e物流||
|| ||shunfeng||顺丰||
||*Y*|| || ||
|| ||youzhengguonei||中国邮政国内包裹/挂号信||
其他编码请到http://code.google.com/p/kuaidi-api/wiki/Open_API_API_URL 查看

= 三、返回结果说明：=
   返回一个可以看到结果的url地址，如：http://www.kuaidi100.com/kuaidiresult?id=23  ，直接访问或用iframe页调用该url（调用方法见后面第四章），即可以看到结果。效果：

   [http://kuaidi-api.googlecode.com/files/html_API_result.jpg]
 

=== 特别提醒：===
   因为EMS、顺丰和申通偶尔会不稳定， * 不稳定时会先显示验证码 * （如下图所示），所以请勿直接将这个页面直接解析成JSON等形式，否则会出错！如下图：

   [http://kuaidi-api.googlecode.com/files/html_API_valicode.jpg]


= 四、整体使用流程：=
   第一步，后台创建链接，调用：http://www.kuaidi100.com/applyurl?key=[]&com=[]&nu=[] ，返回一个url地址，如：http://www.kuaidi100.com/kuaidiresult?id=23 。

   第二步：在要显示结果的页面添加一个iframe标签，将上述结果url地址传入该iframe标签的的src值，即可在该页面查看到结果（如果要实现系统自动地将结果url传入iframe标签的src，请参考下面第五章），iframe代码示范:
{{{
<iframe name="kuaidi100" src="结果url地址" width="600" height="380" marginwidth="0" marginheight="0" hspace="0" vspace="0" frameborder="0" scrolling="no"></iframe>
}}}

== 如果要实现系统自动地将结果url传入iframe标签的src，请参考下面 ==



= 五、ems快递查询API接口应用程序开发方法 =
　﻿（1）显示结果文件(假如以index.php命名)
　　将网站所用的快递公司名称的参数设置成shipping_name,将运单号的参数设置成invoice_no，在要显示结果的位置插入以下代码：　
{{{
　　<h5><span>物流跟踪</span></h5>　
　　<divclass="blank"></div>　
　　<tablewidth="100%" border="0" cellpadding="5"cellspacing="1" bgcolor="#dddddd">　
　　<tr> <tdbgcolor="#ffffff"><div id="retData"></div></td> </tr>　
　　<tr><span>快递100提供技术支持</span></tr>　
　　</table>　
}}}
　　在显示文件的{{{</body>}}}之前加入以下代码：
{{{
　　<script language="javascript">　
　　document.getElementById("retData").innerHTML="<center>正在查询物流信息，请稍后...</center>";
　　var expressid =document.getElementById("shipping_name").innerHTML;　
　　var expressno = document.getElementById("invoice_no").innerHTML;　Ajax.call('kuaidi100/express.php?com='+expressid+'&nu=' + expressno,'showtest=showtest', function(data){document.getElementById("retData").innerHTML=data;},'GET', 'TEXT'); //这里的kuaidi100/express.php指请求文件，见下面
　　</script>　
}}}

　　（2）查询文件(假如以kuaidi100/express.php命名)　
{{{
　　<?php
　　$typeCom = $_GET["com"];
　　$typeNu = $_GET["nu"];
　　//echo $typeCom.'<br/>' ;
　　//echo $typeNu ;
　　include_once("kuaidi100_company.php");
　　if(isset($typeCom)&&isset($typeNu)){
　　$AppKey='XXXXXXX';//请将XXXXXX替换成您在快递100网站申请到的授权key，授权key请到http://www.kuaidi100.com/openapi获得
　　$url= 'http://www.kuaidi100.com/applyurl?key='.$AppKey.'&com='.$typeCom.'&nu='.$typeNu;

　　//优先使用curl模式发送数据
　　if(function_exists('curl_init') == 1){
　　$curl = curl_init();
　　curl_setopt ($curl, CURLOPT_URL, $url);
　　curl_setopt ($curl, CURLOPT_HEADER,0);
　　curl_setopt ($curl, CURLOPT_RETURNTRANSFER,1);
　　curl_setopt ($curl,CURLOPT_USERAGENT,$_SERVER['HTTP_USER_AGENT']);
　　curl_setopt ($curl, CURLOPT_TIMEOUT,5);
　　$get_content = curl_exec($curl);
　　curl_close ($curl);
　　}else{
　　include("snoopy.php");
　　$snoopy = new snoopy();
　　$snoopy->referer ='google';//请将google替换成google的完整网址
　　$snoopy->fetch($url);
　　$get_content = $snoopy->results;
　　}
　　/$get_content=iconv('UTF-8','GB2312//IGNORE', $get_content);
　　//if(strpos($get_content,'地点和跟踪进度')== false){
　　// echo '查询失败，请重试';
　　//}
　　print_r('<iframesrc="'.$get_content.'" width="580"height="380"><br/>' . $powered);
　　}else{
　　echo'查询失败，请重试';
　　}
　　exit();
　　?>
}}}